---
title: "envios_postales"
output: html_document
---
# Envíos Postales

### Cartas Enviadas 

```{r fig.height = fig_height_small}
## columnas CF y C
operadores <- importar_totales_trafico("C") %>%
  flujo_semestral() %>%
  mutate(numeric = numeric/1e6,
         operador="PJH")

pjh <- importar_totales_trafico("CF", header_row = 3) %>%
  flujo_semestral() %>%
  mutate(numeric = numeric/1e6,
         operador="Operadores")

bind_rows(operadores, pjh) %>% 
  arrange(year, semester, operador) %>% 
  mutate(fecha = glue("'{year  %% 100}-{semester}")) %>% 
  group_by(fecha) %>% 
  mutate(y_pos = dplyr::lag(numeric, default = 0) + numeric/2) %>% 
  ungroup() %>% 
  ggplot(aes(fecha, numeric, fill=fct_infreq(operador))) + 
  geom_col(position=position_stack(reverse=TRUE)) +
  geom_text(aes(label=scales::number_format(accuracy=1)(numeric), y=y_pos),
            color="white") + 
  scale_fill_manual("", values=c( paleta_cats[["rojo"]], pal[5])) +
  labs(x="", y="", caption="Millones de cartas") +
  guides(fill = guide_legend(direction="horizontal")) + 
  theme(legend.position = c("top"),
        plot.caption = element_text(vjust=6, hjust=0),
        axis.text.x    = ggplot2::element_text(vjust=6))
```

### Paquetes Enviados
```{r fig.height = fig_height_small}
## ED
importar_totales_trafico("ED", header_row = 3) %>%
  flujo_semestral() %>%
  mutate(numeric = numeric/1e3) %>%
  serie_historica_semestral_flujo(numeric) + 
  labs(x="Semestre", y="Miles")
```


### Envíos Postales (en millones)
```{r}
## EG
importar_totales_trafico("EG", header_row = 3) %>%
  flujo_semestral() %>%
  mutate(numeric=numeric/1e6) %>%
  serie_historica_semestral_flujo(numeric)

```


### Cartas del SPU (millones)
```{r}
## FD
importar_totales_trafico("FD") %>%
 flujo_semestral() %>%
  mutate(numeric=numeric/1e6) %>%
  serie_historica_semestral_flujo(numeric)
```

### Paquetes del SPU (miles)
```{r}
## FC
importar_totales_trafico("FC") %>%
  flujo_semestral() %>%
  mutate(numeric=numeric/1e3) %>%
  serie_historica_semestral_flujo(numeric)
```

### Envíos del SPU (millones)

```{r}
## FB
importar_totales_trafico("FB") %>%
  flujo_semestral() %>%
  mutate(numeric=numeric/1e6) %>%
  serie_historica_semestral_flujo(numeric)
```


### Total semestral de Cartas Nacionales (en millones)
```{r}
## H
importar_totales_trafico("CA")  %>%
  flujo_semestral() %>%
  mutate(numeric=numeric/1e6) %>%
  serie_historica_semestral_flujo(numeric)

```


### Salida de Cartas Internacionales (en miles)
```{r}
## CB
importar_totales_trafico("CB")  %>%
  flujo_semestral() %>%
  mutate(numeric=numeric/1e3) %>%
  serie_historica_semestral_flujo(numeric)
```

### Entrada de Cartas Internacionales (en miles)
```{r}
## CD
importar_totales_trafico("CC")  %>%
  flujo_semestral() %>%
  mutate(numeric=numeric/1e3) %>%
  serie_historica_semestral_flujo(numeric)
```

### Paquetes Nacionales (en miles)
```{r}
## DZ
importar_totales_trafico("DZ")  %>%
  flujo_semestral() %>%
  mutate(numeric=numeric/1e3) %>%
  serie_historica_semestral_flujo(numeric)
```

### Salida de Paquetes Internacionales (en miles)
```{r}
## EA
importar_totales_trafico("EA")  %>%
  flujo_semestral() %>%
  mutate(numeric=numeric/1e3) %>%
  serie_historica_semestral_flujo(numeric)
```

### Entrada de Paquetes Internacionales (en miles)
```{r}
## EB
importar_totales_trafico("EB")  %>%
  flujo_semestral() %>%
  mutate(numeric=numeric/1e3) %>%
  serie_historica_semestral_flujo(numeric)
```

### Composición de Cartas
```{r}
importar_totales_trafico(c("CA", "CB", "CC")) %>%
  filter(year(fecha)==2020, semester(fecha)==1) %>%
  group_by(cabezal) %>%
  summarize(numeric=round(sum(numeric))) %>% 
  barras_horizontales(numeric, cabezal)
```

### Composición de Paquetes
```{r}
## DZ-EB
importar_totales_trafico(c("DZ", "EA", "EB")) %>%
  filter(year(fecha)==2020, semester(fecha)==1) %>%
  group_by(cabezal) %>%
  summarize(numeric=round(sum(numeric))) %>% 
  barras_horizontales(numeric, cabezal)
```

### Cartas Nacionales
```{r}
importar_totales_trafico(c("H", "W", "AL", "BA", "BP"),
                         header_row = list("cabezal_1"=3, "cabezal_2"=4)) %>%
    filter(year(fecha)==2020, semester(fecha)==1) %>%
    filter(cabezal_2=="TOTAL") %>%
    group_by(cabezal_1) %>%
    summarize(numeric=round(sum(numeric))) %>%
    barras_horizontales(numeric, cabezal_1)

```

### Salida de Cartas Internacionales


```{r}
importar_totales_trafico(c("BU", "BF", "AQ", "AB", "M"),
                         header_row = list("cabezal_1"=3, "cabezal_2"=4)) %>%
    filter(year(fecha)==2020, semester(fecha)==1) %>%
    filter(cabezal_2=="TOTAL") %>%
    group_by(cabezal_1) %>%
    summarize(numeric=round(sum(numeric))) %>%
    barras_horizontales(numeric, cabezal_1)
```

### Entrada de Cartas Internacionales
```{r}
importar_totales_trafico(c("R", "AG", "AV", "BK", "BZ"),
                         header_row = list("cabezal_1"=3, "cabezal_2"=4)) %>%
    filter(year(fecha)==2020, semester(fecha)==1) %>%
    filter(cabezal_2=="TOTAL") %>%
    group_by(cabezal_1) %>%
    summarize(numeric=round(sum(numeric))) %>%
    barras_horizontales(numeric, cabezal_1)
```

### Paquetes Nacionales

```{r}
importar_totales_trafico(c("CR", "DA", "DJ", "DS"),
                         header_row = list("cabezal_1"=3, "cabezal_2"=4)) %>%
    filter(year(fecha)==2020, semester(fecha)==1) %>%
    filter(cabezal_2=="TOTAL") %>%
    group_by(cabezal_1) %>%
    summarize(numeric=round(sum(numeric))) %>%
    filter(numeric > 0) %>%
    barras_horizontales(numeric, cabezal_1)

```

### Salida de Paquetes Internacionales

```{r}
importar_totales_trafico(c("CL", "CU", "DD", "DM", "DV"),
                         header_row = list("cabezal_1"=3, "cabezal_2"=4)) %>%
    filter(year(fecha)==2020, semester(fecha)==1) %>%
    filter(cabezal_2=="TOTAL") %>%
    group_by(cabezal_1) %>%
    summarize(numeric=round(sum(numeric))) %>%
    barras_horizontales(numeric, cabezal_1)
```

### Entrada de Paquetes Internacionales
```{r}
importar_totales_trafico(c("CX", "DG", "DP", "DY"),
                         header_row = list("cabezal_1"=3, "cabezal_2"=4)) %>%
    filter(year(fecha)==2020, semester(fecha)==1) %>%
    filter(cabezal_2=="TOTAL") %>%
    group_by(cabezal_1) %>%
    summarize(numeric=round(sum(numeric))) %>%
    barras_horizontales(numeric, cabezal_1)
```
